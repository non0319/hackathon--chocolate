@use '_mixin' as *;

$card-width: 260px;
$card-height: 400px;
$overlap-amount: 50px;

.card-stack-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin: 100px auto 150px;
    perspective: 1500px;

    @include sp {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;

        flex-direction: initial;
        align-items: initial;
        margin: 50px auto;
        perspective: none;
        padding: 0 16px;
    }
}

.info-card {
    width: $card-width;
    height: $card-height;
    background-color: $sub-color;
    border-radius: 12px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transform-origin: 50% 100%;
    cursor: pointer;
    position: relative;

    --transform-duration: 0.1s;

    transition:
        transform var(--transform-duration) ease,
        box-shadow 0.1s ease,
        z-index 0.4s,
        opacity 1.2s ease,
        border-radius 0.3s ease;

    margin-left: -$overlap-amount;

    &:first-child {
        margin-left: 0;
    }

    opacity: 0;
    transform: translateX(100px) rotate(0deg);

    // Mobile Layout: スタイルリセット (2x2グリッド対応)
    @include sp {
        width: 100%;
        max-width: none;
        height: auto;
        min-height: 150px;
        margin-left: 0;
        margin-bottom: 0;
        opacity: 1;
        transform: none;
        transition: box-shadow 0.1s ease, border-radius 0.3s ease;
    }

    &[data-card-id="1"] {
        z-index: 1;
    }

    &[data-card-id="2"] {
        z-index: 2;
    }

    &[data-card-id="3"] {
        z-index: 3;
    }

    &[data-card-id="4"] {
        z-index: 4;
    }

    // Mobile: アクティブ状態のz-indexをリセット
    @include sp {
        &[data-card-id] {
            z-index: auto;
        }
    }
}

// ------------------------------------------------
// ★★★ アクティブ状態 (PCのみの広がる演出: 1.2s) ★★★
// ------------------------------------------------
.card-stack-container.is-active {

    .info-card {

        --transform-duration: 1.2s;

        transition-delay: 0.1s !important;
        opacity: 1;

        // Mobile: アニメーション無効化
        @include sp {
            transform: none !important;
            transition: box-shadow 0.1s ease, border-radius 0.3s ease !important;
            transition-delay: 0s !important;
        }
    }

    & .info-card[data-card-id="1"] {
        transform: rotate(-13deg) translateY(10px) translateZ(50px);
        transition-delay: 0.1s;
    }

    & .info-card[data-card-id="2"] {
        transform: rotate(-5deg) translateY(0px) translateZ(30px);
        transition-delay: 0.3s;
    }

    & .info-card[data-card-id="3"] {
        transform: rotate(5deg) translateY(20px) translateZ(10px);
        transition-delay: 0.5s;
    }

    & .info-card[data-card-id="4"] {
        transform: rotate(15deg) translateY(70px) translateZ(0px);
        transition-delay: 0.7s;
    }
}

// ------------------------------------------------
// ★ ホバーアニメーション (PCのみの飛び出す演出: 0.1s) ★
// ------------------------------------------------
.info-card:hover {
    @media (min-width: 769px) {
        --transform-duration: 0.1s;

        transform:
            scale(1.05) translateY(-20px) translateZ(100px) rotate(0deg) !important;
        box-shadow: 0 30px 50px rgba(0, 0, 0, 0.3);
        z-index: 10;
    }
}


// ------------------------------------------------
// カードコンテンツのスタイル
// ------------------------------------------------
.card-image-wrapper {
    overflow: hidden;
    height: 60%;
    border-radius: 12px 12px 0 0;

    // Mobile: 画像の比率を調整
    @include sp {
        height: 200px; 
    }

    .card-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
}

.card-text-content {
    padding: 15px;
    text-align: left;
    position: relative; // 矢印の親要素

    .card-number {
        font-size: 1.5rem; 
        font-weight: bold;
        color: $main-color;
    }

    .card-title-text {
        font-size: 0.9rem; 
        margin-top: 5px;
    }

    // ------------------------------------------------
    // ★ モバイル用矢印スタイル (カード右下に配置)
    // ------------------------------------------------
    .mobile-arrow-icon {
        display: none; // PCでは非表示

        @include sp {
            display: block;
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 20px; 
            height: 20px;

            // 矢印
            border: solid $main-color;
            border-width: 0 2px 2px 0; 
            padding: 3px;

            transform: rotate(45deg); // 初期状態は右向き下
            transition: transform 0.3s ease;
        }
    }
}

// ------------------------------------------------
// 詳細セクションのスタイル (PC用)
// ------------------------------------------------
#card-detail-section {
    background-color: $sub-color;
    border-radius: 12px;
    padding: 30px;
    margin: 40px auto;
    width: min(90%, 900px);
    height: 0;
    opacity: 0;
    overflow: hidden;
    transition: height 0.4s ease, opacity 0.4s ease;

    // Mobileでは非表示（JSで生成されるアコーディオンを使用）
    @include sp {
        display: none;
    }

    &.is-open {
        height: auto;
        opacity: 1;
        min-height: 200px;
    }

    .detail-content {
        text-align: left;

        h3 {
            color: $main-color;
            margin-bottom: 10px;
        }
    }
}

// ------------------------------------------------
// モバイル専用アコーディオンのスタイル (JSで生成され、カードの直後に挿入されます)
// ------------------------------------------------
.mobile-detail-accordion {


    @include sp {
        // グリッドレイアウトで2列にまたがるように設定
        grid-column: 1 / span 2;
        width: 100%;
        margin-bottom: 0; 
        border-radius: 0 0 12px 12px;
        padding: 0 15px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    }

    .detail-content {
        padding: 15px 0;

        h3 {
            color: $main-color;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        p {
            font-size: 0.95rem;
            line-height: 1.7;
        }
    }

    &.is-open {
        max-height: 500px;
        padding: 15px;
    }
}

// ------------------------------------------------
// バイル用プレースホルダー
// ------------------------------------------------
.mobile-accordion-placeholder {
    @include sp {
        grid-column: 1 / span 2;
        height: 0;
        width: 100%;
        margin-bottom: 16px;
        transition: height 0.3s ease-out;
        background-color: transparent;
    }
}


// ------------------------------------------------
// モバイル開閉状態と矢印の連携
// ------------------------------------------------
.info-card.is-active-mobile {
    // 開いている状態のカードのスタイル
    border-radius: 12px 12px 0 0 !important;

    // 矢印を回転させる (開いているので上向き)
    .mobile-arrow-icon {
        transform: rotate(-135deg);
    }
}