@use '_mixin' as *;

$card-width: 260px;
$card-height: 400px;
$overlap-amount: 50px;
$new-card-width-pc: 480px;


.card-stack-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin: 100px auto 200px;
    perspective: 1500px;
}

.info-card {
    width: $card-width;
    height: $card-height;
    background-color: $sub-color;
    border-radius: 12px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transform-origin: 50% 100%;

    // ホバー解除時の戻り速度の基本設定 (0.1s)
    transition:
        transform 0.1s ease-out,
        box-shadow 0.1s ease-out,
        z-index 0.4s,
        opacity 1.2s ease-out;

    margin-left: -$overlap-amount;

    &:first-child {
        margin-left: 0;
    }

    // 初期状態 (スクロール前)
    opacity: 0;
    transform: translateX(100px) rotate(0deg);

    &[data-card-id="1"] {
        z-index: 1;
    }

    &[data-card-id="2"] {
        z-index: 2;
    }

    &[data-card-id="3"] {
        z-index: 3;
    }

    &[data-card-id="4"] {
        z-index: 4;
    }
}

// ------------------------------------------------
// ★★★ アクティブ状態 (広がる演出: 1.2s) ★★★
// ------------------------------------------------
.card-stack-container.is-active {

    .info-card {
        // 広がる演出時のみ transform を1.2sに上書き
        transition:
            transform 1s ease-out,
            box-shadow 0.1s ease-out,
            z-index 0.4s,
            opacity 1s ease-out;

        transition-delay: 0.1s !important;
        opacity: 1;

    }

    & .info-card[data-card-id="1"] {
        transform: rotate(-13deg) translateY(10px) translateZ(50px);
        transition-delay: 0.1s;
    }

    & .info-card[data-card-id="2"] {
        transform: rotate(-5deg) translateY(0px) translateZ(30px);
        transition-delay: 0.3s;
    }

    & .info-card[data-card-id="3"] {
        transform: rotate(5deg) translateY(20px) translateZ(10px);
        transition-delay: 0.5s;
    }

    & .info-card[data-card-id="4"] {
        transform: rotate(15deg) translateY(70px) translateZ(0px);
        transition-delay: 0.7s;
    }
}

// ------------------------------------------------
// ホバーアニメーション
// ------------------------------------------------
.info-card:hover {
    transition: transform 0.3s ease-out !important;
    box-shadow: 0.3s ease-out !important;
    z-index: 0.3s !important;
    opacity: 0.3s ease-out !important;

    transform:
        scale(1.05) translateY(-20px) translateZ(100px) rotate(0deg) !important; // ★ 2. transform の後にセミコロン

    box-shadow: 0 30px 50px rgba(0, 0, 0, 0.3); // ★ 3. box-shadow の後にセミコロン

    z-index: 10;
}

// ------------------------------------------------
// カードコンテンツのスタイル
// ------------------------------------------------
.card-image-wrapper {
    overflow: hidden;
    height: 60%;
    border-radius: 12px 12px 0 0;

    .card-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
}

.card-text-content {
    padding: 15px;
    text-align: left;

    .card-number {
        font-size: 2rem;
        font-weight: bold;
        color: $main-color;
    }

    .card-title-text {
        font-size: 1.1rem;
        margin-top: 5px;
    }
}

// ------------------------------------------------
// 詳細セクションのスタイル
// ------------------------------------------------
#card-detail-section {
    background-color: $sub-color;
    border-radius: 12px;
    padding: 30px;
    margin: 40px auto;
    width: min(90%, 900px);
    height: 0;
    opacity: 0;
    overflow: hidden;
    transition: height 0.4s ease-out, opacity 0.4s ease-out;

    &.is-open {
        height: auto;
        opacity: 1;
        min-height: 200px;
    }

    .detail-content {
        text-align: left;

        h3 {
            color: $main-color;
            margin-bottom: 10px;
        }
    }
}


// ==========================================
//SP表示 (メディアクエリ)
// ==========================================
// 1. カードスタックコンテナ全体
.card-stack-container {
    flex-direction: column;
    align-items: center;
    width: 100%;
    perspective: none;
    margin: 50px auto 100px;
}

// 2. 個別カード (画面幅いっぱいに拡大、横並び)
.info-card {
    transform: none !important;
    margin-left: 0 !important;
    margin-top: 25px;

    // ★ SP: カード全体の幅を大きくし、制限を解除
    width: 70%;
    height: 200px;

    cursor: pointer; // タップ可能を示す
    display: flex;
    align-items: center; // 垂直方向中央寄せ
    padding: 15px; // パディングを増やして大きく見せる
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);

    transition: none !important; // アニメーションをリセット

    .card-image-wrapper {
        flex-shrink: 0;
        width: 40%;
        height: auto;
        margin-right: 15px;
        border-radius: 0;


        .card-img {
            width: 100%;
            height: auto;
            max-height: 120px;
        }
    }

    .card-text-content {
        padding: 0;
        width: 50%;
        text-align: center;

        .card-number {
            font-size: 1.8rem;
        }

        .card-title-text {
            font-size: 1.1rem;
        }
    }
}

// 3. 詳細セクション（右側パネル）のスタイル
#card-detail-section {
    // ★★★ SP専用: 画面右端に固定するパネル ★★★
    position: fixed; // 画面に固定
    top: 50%;
    right: 0;
    width: 50%; // 画面幅の85%
    height: 60vh; // 画面いっぱいの高さ
    max-width: none !important;
    z-index: 1000; // 最前面に表示

    background-color: #fff;
    box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);

    // 初期状態：画面右側に隠しておく
    transform: translateX(100%);
    transition: transform 0.3s ease-out;

    // パネルのパディング
    padding: 60px 20px 20px;
    margin: 0;

    // 開いた状態
    &.is-open {
        transform: translateX(0); // 画面内にスライドイン
        opacity: 1;
        height: 50vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .detail-content {
        h3 {
            color: $main-color;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        p {
            font-size: 1rem;
        }
    }

    // パネルを閉じるボタン
    .close-button {
        position: absolute;
        top: 15px;
        left: 15px;
        font-size: 2rem;
        color: #333;
        cursor: pointer;
    }
}

// 4. アクティブ状態やホバーをリセット
.card-stack-container.is-active .info-card,
.info-card:hover {
    transform: none !important;
    opacity: 1;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: none !important;
}